# How To Remove SID History With PowerShell - Goatee PFE - Site Home - TechNet Blogs [blogs.technet.com]

* [TechNet](https://technet.microsoft.com/)

* [Products](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx)
* [IT Resources](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx)
* [Downloads](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx)
* [Training](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx)
* [Support](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx)

* [Sign in](https://login.live.com/login.srf?wa=wsignin1.0&wtrealm=blogs.technet.com&wreply=https%3a%2f%2fblogs.technet.com%2fb%2fashleymcglone%2farchive%2f2011%2f11%2f23%2fhow-to-remove-sid-history-with-powershell.aspx%3fstoAI%3d10&wp=MBI_FED_SSL&wlcxt=microsoft%24microsoft%24microsoft)

 **<http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx>**

# [Goatee PFE](http://blogs.technet.com/b/ashleymcglone/default.aspx)

Blog of Microsoft Premier Field Engineer Ashley McGlone featuring PowerShell scripts for Active Directory.

Sharing Links

[[#|in**Share**.]]**9**

Options

* [Home](http://blogs.technet.com/b/ashleymcglone/default.aspx)

* [About](http://blogs.technet.com/b/ashleymcglone/about.aspx)
* [Email Blog Author](http://blogs.technet.com/b/ashleymcglone/contact.aspx)
* [Share this](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspxmailto:?subject=How%20To%20Remove%20SID%20History%20With%20PowerShell&body=http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx)
* [RSS for posts](http://blogs.technet.com/b/ashleymcglone/rss.aspx)
* [Atom](http://blogs.technet.com/b/ashleymcglone/atom.aspx)
* [RSS for comments](http://blogs.technet.com/b/ashleymcglone/rsscomments.aspx)

[![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.5.png]]](http://blogs.technet.com/b/heyscriptingguy/archive/2015/01/25/2014-honorary-scripting-guys-announced.aspx)
[![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.6.png]]
Free Active Directory PowerShell
Training from GoateePFE](http://www.microsoftvirtualacademy.com/training-courses/using-powershell-for-active-directory)
[![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/hicks_cover150.jpg]]
Buy a PowerShell book for charity.](http://manning.com/hicks/)

Search Blogs

Search this blog Search all blogs

Tags

* [.NET](http://blogs.technet.com/b/ashleymcglone/archive/tags/-NET/default.aspx)

* [ACE](http://blogs.technet.com/b/ashleymcglone/archive/tags/ACE/default.aspx)
* [ACL](http://blogs.technet.com/b/ashleymcglone/archive/tags/ACL/default.aspx)
* [Active Directory](http://blogs.technet.com/b/ashleymcglone/archive/tags/Active+Directory/default.aspx)
* [AD](http://blogs.technet.com/b/ashleymcglone/archive/tags/AD/default.aspx)
* [ADMT](http://blogs.technet.com/b/ashleymcglone/archive/tags/ADMT/default.aspx)
* [Columbus](http://blogs.technet.com/b/ashleymcglone/archive/tags/Columbus/default.aspx)
* [COPUG](http://blogs.technet.com/b/ashleymcglone/archive/tags/COPUG/default.aspx)
* [DNS](http://blogs.technet.com/b/ashleymcglone/archive/tags/DNS/default.aspx)
* [DogFoodCon](http://blogs.technet.com/b/ashleymcglone/archive/tags/DogFoodCon/default.aspx)
* [download](http://blogs.technet.com/b/ashleymcglone/archive/tags/download/default.aspx)
* [Get-ACL](http://blogs.technet.com/b/ashleymcglone/archive/tags/Get_2D00_ACL/default.aspx)
* [Get-ADObject](http://blogs.technet.com/b/ashleymcglone/archive/tags/Get_2D00_ADObject/default.aspx)
* [Get-ADUser](http://blogs.technet.com/b/ashleymcglone/archive/tags/Get_2D00_ADUser/default.aspx)
* [get-wmiobject](http://blogs.technet.com/b/ashleymcglone/archive/tags/get_2D00_wmiobject/default.aspx)
* [Goals](http://blogs.technet.com/b/ashleymcglone/archive/tags/Goals/default.aspx)
* [GPO](http://blogs.technet.com/b/ashleymcglone/archive/tags/GPO/default.aspx)
* [Group Policy](http://blogs.technet.com/b/ashleymcglone/archive/tags/Group+Policy/default.aspx)
* [Group-Object](http://blogs.technet.com/b/ashleymcglone/archive/tags/Group_2D00_Object/default.aspx)
* [Groups](http://blogs.technet.com/b/ashleymcglone/archive/tags/Groups/default.aspx)
* [hash table](http://blogs.technet.com/b/ashleymcglone/archive/tags/hash+table/default.aspx)
* [helpdesk](http://blogs.technet.com/b/ashleymcglone/archive/tags/helpdesk/default.aspx)
* [Invoke-Command](http://blogs.technet.com/b/ashleymcglone/archive/tags/Invoke_2D00_Command/default.aspx)
* [Invoke-Expression](http://blogs.technet.com/b/ashleymcglone/archive/tags/Invoke_2D00_Expression/default.aspx)
* [Microsoft](http://blogs.technet.com/b/ashleymcglone/archive/tags/Microsoft/default.aspx)
* [Microsoft Virtual Academy](http://blogs.technet.com/b/ashleymcglone/archive/tags/Microsoft+Virtual+Academy/default.aspx)
* [module](http://blogs.technet.com/b/ashleymcglone/archive/tags/module/default.aspx)
* [MVA](http://blogs.technet.com/b/ashleymcglone/archive/tags/MVA/default.aspx)
* [Powershell](http://blogs.technet.com/b/ashleymcglone/archive/tags/Powershell/default.aspx)
* [PowerShell Saturday](http://blogs.technet.com/b/ashleymcglone/archive/tags/PowerShell+Saturday/default.aspx)
* [Remoting](http://blogs.technet.com/b/ashleymcglone/archive/tags/Remoting/default.aspx)
* [Repadmin](http://blogs.technet.com/b/ashleymcglone/archive/tags/Repadmin/default.aspx)
* [Schema](http://blogs.technet.com/b/ashleymcglone/archive/tags/Schema/default.aspx)
* [SDDL](http://blogs.technet.com/b/ashleymcglone/archive/tags/SDDL/default.aspx)
* [Set-ACL](http://blogs.technet.com/b/ashleymcglone/archive/tags/Set_2D00_ACL/default.aspx)
* [Set-ADObject](http://blogs.technet.com/b/ashleymcglone/archive/tags/Set_2D00_ADObject/default.aspx)
* [SID](http://blogs.technet.com/b/ashleymcglone/archive/tags/SID/default.aspx)
* [SID History](http://blogs.technet.com/b/ashleymcglone/archive/tags/SID+History/default.aspx)
* [SIDhistory](http://blogs.technet.com/b/ashleymcglone/archive/tags/SIDhistory/default.aspx)
* [SiteLinks](http://blogs.technet.com/b/ashleymcglone/archive/tags/SiteLinks/default.aspx)
* [Sites](http://blogs.technet.com/b/ashleymcglone/archive/tags/Sites/default.aspx)
* [SYSTEMINFO](http://blogs.technet.com/b/ashleymcglone/archive/tags/SYSTEMINFO/default.aspx)
* [techmentor](http://blogs.technet.com/b/ashleymcglone/archive/tags/techmentor/default.aspx)
* [Token Bloat](http://blogs.technet.com/b/ashleymcglone/archive/tags/Token+Bloat/default.aspx)
* [Token Size](http://blogs.technet.com/b/ashleymcglone/archive/tags/Token+Size/default.aspx)
* [v3](http://blogs.technet.com/b/ashleymcglone/archive/tags/v3/default.aspx)
* [Windows 8](http://blogs.technet.com/b/ashleymcglone/archive/tags/Windows+8/default.aspx)
* [Windows Server 2012](http://blogs.technet.com/b/ashleymcglone/archive/tags/Windows+Server+2012/default.aspx)
* [WMI](http://blogs.technet.com/b/ashleymcglone/archive/tags/WMI/default.aspx)
* [write-progress](http://blogs.technet.com/b/ashleymcglone/archive/tags/write_2D00_progress/default.aspx)

Archive

* [January 2015](http://blogs.technet.com/b/ashleymcglone/archive/2015/01.aspx) (1)

* [December 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/12.aspx) (1)
* [November 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/11.aspx) (1)
* [October 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/10.aspx) (2)
* [September 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/09.aspx) (2)
* [August 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/08.aspx) (2)
* [July 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/07.aspx) (1)
* [June 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/06.aspx) (1)
* [May 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/05.aspx) (2)
* [April 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/04.aspx) (2)
* [March 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/03.aspx) (2)
* [February 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/02.aspx) (1)
* [January 2014](http://blogs.technet.com/b/ashleymcglone/archive/2014/01.aspx) (1)
* [December 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/12.aspx) (1)
* [November 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/11.aspx) (1)
* [October 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/10.aspx) (1)
* [September 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/09.aspx) (1)
* [August 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/08.aspx) (1)
* [July 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/07.aspx) (2)
* [June 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/06.aspx) (1)
* [May 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/05.aspx) (1)
* [April 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/04.aspx) (1)
* [March 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/03.aspx) (1)
* [February 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/02.aspx) (1)
* [January 2013](http://blogs.technet.com/b/ashleymcglone/archive/2013/01.aspx) (2)
* [December 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/12.aspx) (1)
* [November 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/11.aspx) (2)
* [October 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/10.aspx) (1)
* [September 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/09.aspx) (2)
* [August 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/08.aspx) (1)
* [July 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/07.aspx) (2)
* [June 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/06.aspx) (2)
* [May 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/05.aspx) (2)
* [April 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/04.aspx) (1)
* [March 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/03.aspx) (2)
* [February 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/02.aspx) (2)
* [January 2012](http://blogs.technet.com/b/ashleymcglone/archive/2012/01.aspx) (3)
* [December 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/12.aspx) (1)
* [November 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/11.aspx) (1)
* [October 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/10.aspx) (1)
* [September 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/09.aspx) (3)
* [August 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/08.aspx) (2)
* [July 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/07.aspx) (2)
* [June 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/06.aspx) (1)
* [May 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/05.aspx) (2)
* [April 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/04.aspx) (3)
* [March 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/03.aspx) (2)
* [February 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/02.aspx) (1)
* [January 2011](http://blogs.technet.com/b/ashleymcglone/archive/2011/01.aspx) (1)
* [December 2010](http://blogs.technet.com/b/ashleymcglone/archive/2010/12.aspx) (1)
* [November 2010](http://blogs.technet.com/b/ashleymcglone/archive/2010/11.aspx) (1)
* [October 2010](http://blogs.technet.com/b/ashleymcglone/archive/2010/10.aspx) (1)
* [September 2010](http://blogs.technet.com/b/ashleymcglone/archive/2010/09.aspx) (1)
* [August 2010](http://blogs.technet.com/b/ashleymcglone/archive/2010/08.aspx) (1)

Translate This Page

Translate this page[[#|]]

**[TechNet Blogs](http://blogs.technet.com/)** » **[Goatee PFE](http://blogs.technet.com/b/ashleymcglone/default.aspx)** » **[How To Remove SID History With PowerShell](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx)**

### How To Remove SID History With PowerShell

![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.7.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.2.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.7.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.2.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.7.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.2.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.7.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.2.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.3.png]]![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.1.png]]
 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/avatar.jpg]][Ashley McGlone](http://social.technet.microsoft.com/profile/Ashley%20McGlone)
23 Nov 2011 10:34 AM

* **[9](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx#comments)**

_Update:  To see all articles in this series [click here](http://blogs.technet.com/b/ashleymcglone/archive/tags/SID+History/)._

In the United States we celebrate [Thanksgiving](http://en.wikipedia.org/wiki/Thanksgiving) tomorrow.  No matter where you are in the world let us all give thanks for PowerShell.  If Windows were the pumpkin pie, then PowerShell would be the whipped cream on top.  If Active Directory were the turkey, then PowerShell would be the stuffing.  If Exchange were the mashed potatoes, then PowerShell would be the gravy.  Eating and scripting are complementary passions, so we give thanks for both.

This post is part four in the "PowerShell: SID Walker, Texas Ranger" series on documenting and remediating **SID history** in your AD forest. Go back and read over the [previous articles in the series](http://blogs.technet.com/b/ashleymcglone/archive/tags/sid+history/) if you haven't had a chance yet. In today's post we will look at the final step of remediating SID history:  removing the SID history data from our migrated AD objects.  Cleaning up this stale data will greatly reduce the chance of [token size issues](http://blogs.technet.com/b/ashleymcglone/archive/2011/05/19/using-powershell-to-resolve-token-size-issues-caused-by-sid-history.aspx) for your users.

### Background

In an [earlier post](http://blogs.technet.com/b/ashleymcglone/archive/2011/05/19/using-powershell-to-resolve-token-size-issues-caused-by-sid-history.aspx) I explained the process for cleaning up SID history, and the last step is actually removing the data from your environment.  This is the _last_ step.  It is crucial that you have already remediated your ACLs, swapping old SIDs for new SIDs.  The preferred method is the [ADMT](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=20C0DB45-DB16-4D10-99F2-539B7277CCDB), and then for NAS file shares you can use the function I provided in [part 2](http://blogs.technet.com/b/ashleymcglone/archive/2011/09/16/powershell-sid-walker-texas-ranger-part-2.aspx).  Please note that removing SID history may cause significant impact to your users if you have not taken the time to migrate resource ACLs.  I highly recommend reviewing the [ADMT Guide](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=6D710919-1BA5-41CA-B2F3-C11BCB4857AF) to make sure you have completed all migration steps up to this point.  You have been warned.  Proceed carefully.  As a backout plan make sure you have a good system state backup from two DCs per domain.  Using [VBScript](http://support.microsoft.com/kb/295758) to clear SID history was painful. PowerShell achieves the same end with far fewer lines of code.

### Get-SIDHistory | Remove-SIDHistory

I decided to divide this function into two parts.  I wanted a dynamic AD query to retrieve users and groups by specific criteria as a way to surgically target the SID history removal.  Then I wanted to pipe the entries returned into a dedicated function for doing the actual removal.  This allows us to craft the right AD query in a safe environment before pulling the trigger on SID history.

### Get-SIDHistory

When removing SID history it is best to proceed in phases by department or business unit.  You know the drill.  Start with a few users in IT, then all of IT, then company departments beginning with the least critical business impact (ie. Grounds Keeping before Purchasing).  You must send notification to your users asking them to verify that all of their resource access and drive letters are still good after the change.

Using [Get-ADObject](http://technet.microsoft.com/en-us/library/ee617198.aspx) to query by name or OU is pretty straightforward, so I won't go into much detail there.  The magic of this function, though, is the -DomainName parameter.  You can specify the FQDN of the former domain for which you wish to remove SID history.  Now that is cool!  We can easily target the SID history by domain, because the SID object has a property called [AccountDomainSid](http://msdn.microsoft.com/en-us/library/system.security.principal.securityidentifier.aspx). We don't even have to parse it out. When we get back the SID history entries, we can filter on this attribute to target a specific domain in the SID history.

In order for this to work you have to first use Export-DomainSIDs to create the DomainSIDs.CSV file that maps the domain names to the domain SIDs.  If you don't know the old domain name, then you can use the -DomainSID switch to remove SID history for any unnamed domain.  You can copy the old domain SID from the SIDHistoryReport.CSV file produced by the function Export-SIDMapping (included in the attached code).  You could also modify the DomainSIDs.CSV file by manually adding any other domain names and SIDs from your own documentation.

Another feature of the Get-SIDHistory query is that it handles the multi-value nature of the [sIDHistory](http://msdn.microsoft.com/en-us/library/ms679833(VS.85).aspx) attribute.  We do this using the ExpandProperty parameter of [Select-Object](http://technet.microsoft.com/en-us/library/dd315291.aspx) which I demonstrated [here](http://blogs.technet.com/b/ashleymcglone/archive/2011/05/26/do-over-sid-history-one-liner.aspx).  This allows us to identify and target specific SID history entries when a user has been migrated more than once.  The ExpandProperty parameter ensures that we get a result row for every SID history entry regardless of the count.

Here is an example without ExpandProperty:

Get-ADUser user1 -Property sIDHistory | Select-Object name, sIDHistory | Format-Table name, sIDHistory –AutoSize

name   sidhistory
\----   ----------
user1  {S-1-5-21-3013500491-1380372588-2491230877-1122, S-1-5-21-179552...

Here is an example with ExpandProperty:

Get-ADUser user1 -Property sIDHistory | Select-Object name, sIDHistory -ExpandProperty sidHistory | Format-Table name, sIDHistory –AutoSize

name   Value
\----   -----
user1  S-1-5-21-3013500491-1380372588-2491230877-1122
user1  S-1-5-21-1795525639-2355993942-847153066-1695

Notice that ExpandProperty modifies the property name to "value".  We can rename that at the end of the pipe using Select-Object:

Select-Object DistinguishedName, @{name="SID";expression={$\_.Value}}

Get-SIDHistory takes the parameters you specify, shapes them into an AD query, and then uses [Invoke-Expression](http://technet.microsoft.com/en-us/library/dd347550.aspx) to run it.  In other words, this is code that writes code.  I love that feature of PowerShell.  The query parameters are cumulative.  Therefore you can pile on two or three criteria for laser accuracy.

Here are a few examples of how you can use Get-SIDHistory:

* Get-SIDHistory –SamAccountName ashleym
* Get-SIDHistory –DomainName wingtiptoys.com
* Get-SIDHistory –DomainName wingtiptoys.com –SamAccountName ashleym
* Get-SIDHistory –DomainSID S-1-5-21-2371126157-4032412735-3953120161
* Get-SIDHistory –ObjectClass group
* Get-SIDHistory –SearchBase "OU=Sales,DC=contoso,DC=com"
* Get-SIDHistory –MemberOf MigratedUsers
* Get-SIDHistory | Measure-Object

Experiment with different combinations of parameters until you isolate exactly the targets you need.  Then you can script out multiple statements for each phase of the remediation.

### Remove-SIDHistory

This [short TechNet article](http://technet.microsoft.com/en-us/library/powershell_remove_sid_history(WS.10).aspx) provides syntax for removing SID history:

Get-ADUser –filter 'sidhistory –like "\*"' –searchbase "dc=name,dc=name" –searchscope subtree –properties sidhistory | foreach {Set-ADUser $\_ -remove @{sidhistory=$\_.sidhistory.value}}

That single line of PowerShell is a "resumé-generating-event".  DO NOT RUN THIS LINE IN YOUR ENVIRONMENT IF YOU WANT TO KEEP YOUR JOB.  Wiping SID history for every user all at once is not a best practice (in case you were wondering).

You can call Remove-SIDHistory by specifying the distinguishedName of the object and the SID entry to remove.  However, that is a lot of complicated typing.  The intention is to use Get-SIDHistory to tailor your query to exactly the results you want, and then simply pipe it to Remove-SIDHistory.  This works through a feature of PowerShell [advanced functions](http://technet.microsoft.com/en-us/library/dd347600.aspx) called [cmdlet binding](http://technet.microsoft.com/en-us/library/dd347560.aspx).  The [ValueFromPipelineByPropertyName](http://msdn.microsoft.com/en-us/library/system.management.automation.parametersetmetadata.valuefrompipelinebypropertyname(VS.85).aspx) argument allows us to pipe the output from one function into the next as long as the first output properties match the second input parameters. Features like this make PowerShell truly remarkable.

Get-SIDHistory –SamAccountName ashleym | Remove-SIDHistory

I recommend piping the output of the Remove-SIDHistory to a CSV file for change documentation.  Like this:

Get-SIDHistory –SamAccountName ashleym | Remove-SIDHistory | Export-CSV removed.csv

Your CSV will include a date/time stamp for each entry's removal:

[![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.4.png]]](http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-84-58-metablogapi/4452.image_5F00_59575563.png)

This documentation will come in handy if users start to call and report issues after the removal.  But that shouldn't happen if you are thorough in scrubbing all SID history dependencies prior to removing the data.

### Conclusion

If you've been putting off SID history remediation due to the mystery of how to remove it, then your puzzle is solved.  Using the functions in today's post will make the removal process swift and painless.  Let me reiterate that this is the LAST step in the migration process.  Do not proceed until all of your resource translation is complete and verified.  Phase the remediation by user groups to limit any unforeseen impact.  Following these recommendations will make the transition as smooth as possible.

So if you are celebrating Thanksgiving with family tomorrow and everyone around the table shares something they are thankful for, you can be the geek that is thankful for PowerShell.  Most likely no one else at the table will know what you're talking about.  Just smile and nod.

### Coming Up Next…

In the next installment of our SID history series we'll provide a handy summary of each post in the series.  We will also take the function library we've been using and upgrade it to a PowerShell module.  Then we'll walk through the entire SID history remediation process using the provided cmdlets in this module.

 [![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/unknown_filename.png]] SIDHistoryV1.2.zip](http://blogs.technet.com/cfs-filesystemfile.ashx/__key/telligent-evolution-components-attachments/01-8458-00-00-03-46-70-13/SIDHistoryV1.2.zip)

* [9 Comments](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx#comments)

[SID History](http://blogs.technet.com/b/ashleymcglone/archive/tags/SID+History/default.aspx), [Powershell](http://blogs.technet.com/b/ashleymcglone/archive/tags/Powershell/default.aspx), [SID](http://blogs.technet.com/b/ashleymcglone/archive/tags/SID/default.aspx), [Invoke-Expression](http://blogs.technet.com/b/ashleymcglone/archive/tags/Invoke_2D00_Expression/default.aspx), [AD](http://blogs.technet.com/b/ashleymcglone/archive/tags/AD/default.aspx), [Active Directory](http://blogs.technet.com/b/ashleymcglone/archive/tags/Active+Directory/default.aspx), [Set-ADObject](http://blogs.technet.com/b/ashleymcglone/archive/tags/Set_2D00_ADObject/default.aspx), [Get-ADObject](http://blogs.technet.com/b/ashleymcglone/archive/tags/Get_2D00_ADObject/default.aspx), [Select-Object](http://blogs.technet.com/b/ashleymcglone/archive/tags/Select_2D00_Object/default.aspx), [SIDhistory](http://blogs.technet.com/b/ashleymcglone/archive/tags/SIDhistory/default.aspx)

### Can you help me?  Yes!

If you would like to have me or another Microsoft PFE visit your company and assist with the ideas presented in this blog post, then contact your [Microsoft Premier](http://aka.ms/Premier) Technical Account Manager (TAM) for booking information.

For more information about becoming a Microsoft Premier customer email [PremSale@microsoft.com](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspxmailto:PremSale@microsoft.com?subject=How%20can%20I%20become%20a%20Microsoft%20Premier%20customer?&Body=%0A%0A%0A%0ARefered%20by%20MS%20PFE%20Ashley%20McGlone.&BCC=ashley.mcglone@microsoft.com).  Tell them GoateePFE sent you.

Sharing Links

[[#|in**Share**.]]**9**

Comments

		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/anonymous.gif]]Richard Adams
	22 Aug 2013 10:56 PM
	
	This is great PoSh code.  Thank you so very much for putting all this together.  I work on several AD migration projects a year and always find it useful to add to my "toolbox".  This is going on the top of my list! :)
	
	I would like to recomend an update though.  Often times I am in the Source domain/forest running operations against the Target domain/forest.  It would be very useful to have some way to specify the preferred DC that you want to run the cmdlets against.  I hope this feedback helps you as much as your code has helped me.
	
		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/avatar.jpg]][Ashley McGlone](http://social.technet.microsoft.com/profile/Ashley%20McGlone)
	23 Aug 2013 7:06 PM
	
	Hi Richard,
	
	Thanks for the great feedback.  That is good to hear.
	
	You're not the first to ask for domain/DC targeting with the functions in the module.  It is on my list of future updates.  Thanks for reinforcing this need.
	
	Ashley
	
		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/anonymous.gif]]Anonymous
	19 Dec 2013 10:03 PM
	
	"DO NOT RUN THIS LINE IN YOUR ENVIRONMENT IF YOU WANT TO KEEP YOUR JOB" Maybe next time put that before the line :( Just kidding, I'm currently perusing this series in the hope of finding the solution to all my troubles but I'm in fairly uncharted waters for me so I'm treading very carefully... Thanks heaps.
	
		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/anonymous.gif]]worksfine
	20 Feb 2014 1:27 PM
	
	Hey ! At first, thanks for the great work, i really appreciate this ! but i have also a little problem. i tested it out in our environment and it seemed as if it works fine so far. i made an output file and removed the sid-history of a test-user account. "status removed" with the actual date and the old sid was listed there. but if i do another get-sidhistory for that user account, that old sid still appears. i even did a 1on1 copy of each method and line here how to remove the sid. im a domain admin and can change everything and every other object / attribute, permissions cant be the problem here. any ideas? :)
	
		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/avatar.jpg]][Ashley McGlone](http://social.technet.microsoft.com/profile/Ashley%20McGlone)
	21 Feb 2014 7:22 PM
	
	Hi worksfine,
	Sorry to hear you've run into a snag. Please use the Email Blog Author link at the top right of this page to send me a transcript of your PowerShell session reproducing the problem. (Start-Transcript / Stop-Transcript). Also, what operating system versions and PowerShell versions are involved in your tests?
	Thanks,
	Ashley
	@GoateePFE
	
		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/anonymous.gif]]Mohit
	5 Mar 2014 8:30 AM
	
	Hello Ashley,
	I was wondering if there is way to delete Sid history for selected users after the migration in batches.
	I have recently completed a migration of about 2500 users and now client wants to proceed to Sid history cleanup, but wants to get it done in smaller user batches.
	Please advise on how to proceed for this one.
	Thanks
	Mohit
	
		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/avatar.jpg]][Ashley McGlone](http://social.technet.microsoft.com/profile/Ashley%20McGlone)
	6 Mar 2014 1:29 PM
	
	Hello Mohit,
	Yes, you can remove them in batches. Notice the Get-SIDHistory commands in the middle of the article. You can combine multiple criteria to get the right target audience, and then you can pipe it to Remove-SIDHistory. I also recommend piping the output again to Export-CSV so that you have a record of what changed.
	Hope this helps,
	Ashley
	GoateePFE
	
		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/avatar.1.jpg]][imkottees](http://social.technet.microsoft.com/profile/imkottees)
	25 Mar 2014 8:30 AM
	
	Thank you so much Ashley :-) It helped me to remove the SIDHistory from one of the problematic users.
	
		 ![[./_resources/How_To_Remove_SID_History_With_PowerShell_-_Goatee_PFE_-_Site_Home_-_TechNet_Blogs_blogs.technet.com.resources/anonymous.gif]]kimberlybryan
	16 Aug 2014 8:25 AM
	
	GRACIAS PERO NO ENTIENDO NI UNA PINGA HAHAHA.
	

Leave a Comment

* Name

* Comment
* [Post](http://blogs.technet.com/b/ashleymcglone/archive/2011/11/23/how-to-remove-sid-history-with-powershell.aspx#)

* © 2015 Microsoft Corporation.

* [Terms of Use](http://technet.microsoft.com/en-US/cc300389.aspx)
* [Trademarks](http://www.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx)
* [Privacy & Cookies](http://go.microsoft.com/fwlink/?LinkId=248681)
* 7.1.507.6741
