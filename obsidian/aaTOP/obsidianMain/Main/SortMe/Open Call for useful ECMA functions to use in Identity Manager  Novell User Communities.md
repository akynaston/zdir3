---
tags: ["#xslt"]
---
# Open Call for useful ECMA functions to use in Identity Manager | Novell User Communities

[![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/novell_logo_redonblack.png]]](http://www.novell.com/)

* [Skip to Content](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#top)
* [+ Menu](http://www.novell.com/menu.php)

### [Solutions](http://www.novell.com/solutions)

* [**Data Center**](http://www.novell.com/solutions/data-center)
* [Enterprise Linux Servers](http://www.novell.com/solutions/enterprise-linux-servers)
* [Virtualization & Workload Management](http://www.novell.com/solutions/virtualization-workload)
* [Business Service Management](http://www.novell.com/solutions/business-service-management)
* [**End-User Computing**](http://www.novell.com/solutions/end-user-computing)
* [Collaboration](http://www.novell.com/solutions/collaboration)
* [Enterprise Linux Desktops](http://www.novell.com/solutions/enterprise-linux-desktops)
* [Endpoint Management](http://www.novell.com/solutions/endpoint-management)
* [**Identity & Security**](http://www.novell.com/solutions/identity-and-security)
* [Compliance Management](http://www.novell.com/solutions/compliance-management)
* [Identity & Access Management](http://www.novell.com/solutions/identity-and-access)
* [Security Management](http://www.novell.com/solutions/security-management)

[Not Sure? _Try our solution finder +_](http://www.novell.com/solutions)

### [Products](http://www.novell.com/products)

* [Access Manager](http://www.novell.com/products/accessmanager)
* [Compliance Management Platform](http://www.novell.com/products/compliancemanagementplatform)
* [GroupWise](http://www.novell.com/products/groupwise)
* [Identity Manager](http://www.novell.com/products/identitymanager)
* [Open Enterprise Server](http://www.novell.com/products/openenterpriseserver)
* [PlateSpin Forge](http://www.novell.com/products/forge)
* [PlateSpin Migrate](http://www.novell.com/products/migrate)
* [PlateSpin Orchestrate](http://www.novell.com/products/orchestrate)
* [Sentinel](http://www.novell.com/products/sentinel)
* [SUSE Appliance Program](http://www.novell.com/partners/technology/isv/appliance)
* [SUSE Linux Enterprise Server](http://www.novell.com/products/server)
* [Teaming + Conferencing](http://www.novell.com/products/teaming)
* [ZENworks Configuration Management](http://www.novell.com/products/zenworks/configurationmanagement)
* [ZENworks Endpoint Security Management](http://www.novell.com/products/zenworks/endpointsecuritymanagement)

[_All Products_ +](http://www.novell.com/products)

### [Services](http://www.novell.com/services)

* [Technical Support](http://www.novell.com/support)
* [Technical Training](http://www.novell.com/training)
* [IT Consulting](http://www.novell.com/consulting)
* [Downloads](http://download.novell.com/)
* [Customer Center](http://www.novell.com/center)
* [Support Forums](http://forums.novell.com/)
* [Documentation](http://www.novell.com/documentation)

### [Partners & Community](http://www.novell.com/communities)

* [Partners](http://www.novell.com/partners)
* [Developers](http://developer.novell.com/wiki/index.php/Developer_Home)
* [Users](http://www.novell.com/communities/nui)
* [Cool Solutions](http://www.novell.com/communities/coolsolutions)
* [Blogs](http://www.novell.com/company/blogs)

#### Search

* [Login](http://www.novell.com/communities/login?destination=node/8439/open-call-useful-ecma-functions-use-identity-manager)
	* [Create an Account](https://secure-www.novell.com/selfreg/jsp/createAccount.jsp)
	* [Change Language](http://www.novell.com/common/util/langselect.php?referer=http%3A//www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager)

### [About Novell](http://www.novell.com/company)

* [Contact Us](http://www.novell.com/company/contacts-offices)
* [Our Customers](http://www.novell.com/success)
* [Events Center](http://www.novell.com/events)
* [Connection Magazine](http://www.novell.com/connectionmagazine)
* [Press Room](http://www.novell.com/news/press/room)
* [Novell News Blog](http://www.novell.com/prblogs)

[- Close Menu](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#)

[![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/novell_logo_redonblack.png]]](http://www.novell.com/)

[Request a Sales Call](http://www.novell.com/company/sales_call_request_popup.html?refid=novell.comleftnav&profile_url=http%3A//www.novell.com/communities)

[800-529-3400](http://www.novell.com/company/contact.html)

# Article

* [Cool Solutions](http://www.novell.com/communities/coolsolutions)
* [Novell Forums](http://forums.novell.com/)
* [PartnerNet](http://www.novell.com/communities/partners)
* [Developer](http://developer.novell.com/wiki/index.php/DeveloperNet)
* [NUI](http://www.novell.com/communities/nui)
* [Novell Blogs](http://www.novell.com/company/blogs)
* [Help   _>_](http://www.novell.com/communities/help)
	* [Site Map](http://www.novell.com/communities/sitemap)
	* [Help](http://www.novell.com/communities/help)
	* [Usage](http://www.novell.com/communities/node/2935)
* [Novell Home](http://www.novell.com/)
* [Communities Home](http://www.novell.com/communities)
* [Technical Support](http://www.novell.com/support)
* [Technical Training](http://www.novell.com/training)

## Search

## Share This

* [![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/print.png]]](http://www.novell.com/communities/print/node/8439)
* [![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/digg.png]]](http://digg.com/submit?phase=2&url=http%3A%2F%2Fwww.novell.com%2Fcommunities%2Fnode%2F8439%2Fopen-call-useful-ecma-functions-use-identity-manager&title=Open+Call+for+useful+ECMA+functions+to+use+in+Identity+Manager)
* [![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/slashdot.png]]](http://slashdot.org/slashdot-it.pl?op=basic&url=http%3A%2F%2Fwww.novell.com%2Fcommunities%2Fnode%2F8439%2Fopen-call-useful-ecma-functions-use-identity-manager)
* [![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/delicious.png]]](http://del.icio.us/post?url=http%3A%2F%2Fwww.novell.com%2Fcommunities%2Fnode%2F8439%2Fopen-call-useful-ecma-functions-use-identity-manager&title=Open+Call+for+useful+ECMA+functions+to+use+in+Identity+Manager)

## My Links

* [Groups](http://www.novell.com/communities/og)
* [Cool Solutions](http://www.novell.com/communities/coolsolutions)
* [Recent posts](http://www.novell.com/communities/tracker)
* [Site map](http://www.novell.com/communities/sitemap)
* [News aggregator](http://www.novell.com/communities/aggregator)
	* [Categories](http://www.novell.com/communities/aggregator/categories)
		* [Novell Support Forums - GroupWise 7](http://www.novell.com/communities/aggregator/categories/3)
		* [Novell Support Forums - New Posts](http://www.novell.com/communities/aggregator/categories/2)
		* [SUSE Linux Enterprise in Canada, North & South America](http://www.novell.com/communities/aggregator/categories/1)
	* [Sources](http://www.novell.com/communities/aggregator/sources)

## Most Popular

### Last viewed:

* [Novell Open Audio: Greg Kroah-Hartman on Linux Kernel Development and News from Support](http://www.novell.com/communities/node/2118/novell-open-audio-greg-kroah-hartman-linux-kernel-development-and-news-support)
* [Cool Blogs: Official Novell Bloggers](http://www.novell.com/communities/node/4133/cool-blogs-official-novell-bloggers)
* [Black Duck Software CEO Leads Discussions on Software Compliance](http://www.novell.com/communities/node/2404/black-duck-software-ceo-leads-discussions-software-compliance)

## Events

|     |     |     |     |     |     |     |
| --- | --- | --- | --- | --- | --- | --- |
| **S** | **M** | **T** | **W** | **T** | **F** | **S** |
| 1   | 2   | 3   | [4](http://www.novell.com/communities/event/2009/11/4/day) | [5](http://www.novell.com/communities/event/2009/11/5/day) | 6   | 7   |
| 8   | 9   | 10  | 11  | 12  | 13  | 14  |
| 15  | 16  | 17  | 18  | [19](http://www.novell.com/communities/event/2009/11/19/day) | 20  | 21  |
| 22  | 23  | 24  | 25  | 26  | 27  | 28  |
| [29](http://www.novell.com/communities/event/2009/11/29/day) | [30](http://www.novell.com/communities/event/2009/11/30/day) |     |     |     |     |     |

[»](http://www.novell.com/communities/event/2009/12/01/month/all/all/1)
[«](http://www.novell.com/communities/event/2009/10/01/month/all/all/1)
[November 2009](http://www.novell.com/communities/event/2009/11/17/month)

## Who's online

There are currently _9 users_ and _534 guests_ online.

### Online users

* [rholder](http://www.novell.com/communities/user/805)
* [eaglexpg](http://www.novell.com/communities/user/50068)
* [redbaron](http://www.novell.com/communities/user/5863)
* [RobMansi](http://www.novell.com/communities/user/58011)
* [celiosantana](http://www.novell.com/communities/user/34510)
* [celiosantana](http://www.novell.com/communities/user/34510)
* [coolguys](http://www.novell.com/communities/user/756)
* [geoffc](http://www.novell.com/communities/user/555)
* [warper2](http://www.novell.com/communities/user/4375)

## User login

[Login](http://www.novell.com/communities/communities/login%3Fdestination%3Dnode%252F8439)
[![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/picture-555.1.jpg]]](http://www.novell.com/communities/user/555)

## Open Call for useful ECMA functions to use in Identity Manager

### Author Info

9 June 2009 - 3:01pm
Submitted by: [geoffc](http://www.novell.com/communities/user/555)

[Author Blog](http://www.novell.com/communities/blog/555)
[Author Profile](http://www.novell.com/communities/user/555)

### Tags

[DirXML](http://www.novell.com/communities/taxonomy/term/6) [eDirectory](http://www.novell.com/communities/taxonomy/term/7) [Identity Manager](http://www.novell.com/communities/taxonomy/term/11) [Identity Manager 3.5](http://www.novell.com/communities/taxonomy/term/3422)
[Tags Map](http://www.novell.com/communities/site-tags)
article
Reads:

## 1482

Score:
Average:
5
5
Scores:
1
Your rating:
[Poor](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#20)
[Okay](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#40)
[Good](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#60)
[Great](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#80)
[Awesome](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#100)

Comments:

## 3

An article that David Gersic just wrote
[Adding Regular Expression Matching to XPath in Identity Manager](http://www.novell.com/communities/node/8434/adding-regular-expression-matching-xpath-identity-manager) reminded me of something I had wanted to do for a while...

We should get an article going that lists off useful ECMA functions to use in Identity Manager. I have a bunch that I have been using, and possibly would be useful to others.

I found out after this was written that there is a [Wiki page for ECMA function](http://wiki.novell.com/index.php/ECMAScript_Examples), and I have put a link there, back to this article. Lets try and keep both in mind.

I found that this approach was really successful when trying to gather up all the possible values for DirXML-Associations, as you can see in this article:
[Open Call - IDM Association Values for eDirectory Objects](http://www.novell.com/communities/node/1696/open-call-idm-association-values-edirectory-objects)

Lets see if we can do as well with ECMA Script functions as well!

With Novell Identity Manager 3.5 and higher, Novell added the ability to call ECMA Script functions from [policy](http://www.novell.com/communities/glossary/term/3000).

This is a great feature as anything you cannot do with DirXML Script, as powerful as it is, you can usually do in ECMA Script. Before you could have written some [Java](http://www.novell.com/communities/glossary/term/1591) class to do what was needed, but ECMA Script is somewhat easier and samples are a little more common. ECMA Script is the new name (or possibly correct name now) for JavaScript.

David was pretty detailed in how you go about using an ECMA Script in his article, so I won't repeat his instructions other than to point you at his article for those details. In short, you store the ECMA Function in a ECMA object somewhere in the tree, you link it to the Driver you are using, add it to the [namespace](http://www.novell.com/communities/glossary/term/827), and when you need to call it, you prefix the function name with es: in your XPATH call.

David's example was great, using Regular expressions inside an XPATH statement, since the XPATH equality test (= sign) is an exact compare and does not use anything more fun like regular expressions.

Here is his matches(arg1, arg2) function that uses some of the ECMA Regular Expression functionality, and makes it available in XPATH.

/\*\* Return true or false based on a Regular Expression match
\* @param {String} s1 the string to test
\* @param {String} s2 the regex string to test it with
\* @type Boolean
\* @return a boolean true or false
\*/
function matches(s1,s2)
{
 // Build search and replace options.
 var options = "";
 
 var re = new RegExp(s2, options);
 if (s1.match(re)) {
  return true;
 } else {
  return false;
 }
}

David gets first billing, only because he inspired me to write this, but otherwise first billing would have to go to Lothar Haeger and his Password Notification Driver, [http://www.novell.com/communities/node/2277/idm-35...](http://www.novell.com/communities/node/2277/idm-35-password-notification-service-driver) which if you have not yet looked at you should.

My theory is that if you examine the driver in detail there are at least three things you will learn from it. Even pretty experienced Identity Manager developers can possibly learn something from this driver. You can read this article: [An even easier way to call a Job from policy](http://www.novell.com/communities/node/5907/ism-even-easier-way-call-job-policy) for my thoughts on what you will learn if you look at his driver in detail.

One of those items is the use of an ECMA Script [LDAP](http://www.novell.com/communities/glossary/term/1613) search function. This has some real advantages over a regular query token in DirXML Script. The primary one, is that for LDAP searching, the standard allows for the use of a filter. In other words, you can search for all objects, that meet some filter. The token query can specify the [object class](http://www.novell.com/communities/glossary/term/1955) as a type of filter, like only return User objects, but cannot do other filter things like only return objects that have values for an attribute. Lets say you want to find all user objects in your tree that have say a value for uidNumber, since you want to be sure you have unique uidNumber values, so as not to freak out your Unix or Linux system that is using pam\_ldap to authenticate.

With a DirXML Token, you could query for all object class User objects, but you could not say only return objects with a value for uidNumber. Rather you would get an empty node set for users without one. Thus you would have to clear up all those empty node sets in order to work through them. With an LDAP query you could use a filter of (uidNumber=\*) to only get objects that have a value populated for uidNumber.

The filter can be more complex than that, and have multiple predicates in it, which is much more powerful to control the results than the Query token.

On the other hand, in defense of the query token, it is very powerful and useful, and has the ability to do paged queries (query-ex) which is controlled by the max number returned parameter in Policy Builder. This is great, as you can really save memory by only looking at 50 node set results (lets say) at a time. Rather than trying to load all thousands of objects into a node set variable to then process.

Regardless, there are great use cases for both, and here you can see how to use ldapSearch via ECMA.

importPackage(Packages.com.novell.ldap);
 
/\*\*
 \*  ldapSearch
 \*
 \* @param (String} host                         LDAP Server, either DNS or IP-Address
 \* @param (Number} port                 LDAP listening port
 \* @param (String} user                 user account, full distinguished name, LDAP syntax
 \* @param (String} password             the cleartext LDAP userpassword
 \* @param (String} base                         search base
 \* @param (String} scope                        (base | one | sub)
 \* @param (String} filter               LDAP search filter according to RFC2254 (see {@link #ldapCount(DirContext, String, String)}
 \* @param (String} attrList                     comma separated list of attributes to return
 \* @param (Number} maxResultSet         maximum result set size (0=unlimited)
 \* @type Nodeset                   
 \* @return NodeSet containing instances from search result, or status element with error message
 \*/
function ldapSearch(host, port, user, password, base, scope, filter, attrList, maxResultSet)
{
        var nodeSet = new Packages.com.novell.xml.xpath.NodeSet();
        var document = Packages.com.novell.xml.dom.DocumentFactory.newDocument();
        var ndsElement   = document.createElement("nds");
        document.appendChild(ndsElement);
        ndsElement.setAttributeNS(null, "dtdversion", "3.5");   
        var outputElement = document.createElement("output");
        ndsElement.appendChild(outputElement);
        var searchScope = LDAPConnection.SCOPE\_ONE;
        if (scope == "base")
        {
                searchScope = LDAPConnection.SCOPE\_BASE;
        } else if (scope == "sub")
        {
                searchScope = LDAPConnection.SCOPE\_SUB;
        }
        
        var attrSplit = attrList.split(',');
        var attrArray = java.lang.reflect.Array.newInstance(java.lang.String, attrSplit.length);
        for (var attrIndex in attrSplit)
        {
                attrArray\[attrIndex\] = attrSplit\[attrIndex\];
        }
        
                
        var lc = new LDAPConnection();
        // set search result set size limit
        var searchConstraints = new LDAPSearchConstraints(lc.getSearchConstraints());
    searchConstraints.setMaxResults(maxResultSet);
    lc.setConstraints(searchConstraints);
    
        try
        {
           // connect and bind to the server
                lc.connect( host, port );
                lc.bind( LDAPConnection.LDAP\_V3, user, new java.lang.String(password).getBytes("UTF8") );
                var searchResults = lc.search(base,
                                                                        searchScope,
                                                                        filter,
                                                                        attrArray,         // return all attributes
                                                                        false);       // return attrs and values
                /\* process the results
                 \*   -- The first while loop goes through all the entries
                 \*   -- The second while loop goes through all the attributes
                 \*   -- The third while loop goes through all the attribute values
                 \*/
                while (searchResults.hasMore())
                {
                        var nextEntry = searchResults.next();
                        // create the instance node
                        var instanceElement = document.createElement("instance");
                        instanceElement.setAttributeNS(null,"src-dn", nextEntry.getDN());
                        var attributeSet = nextEntry.getAttributeSet();
                        var allAttributes = attributeSet.iterator();
                        // create the attr nodes
                        while(allAttributes.hasNext())
                        {
                                var attribute = allAttributes.next();
                                var attrElement = document.createElement("attr");
                                attrElement.setAttributeNS(null, "attr-name", attribute.getName());
                                var allValues = attribute.getStringValues();
                                
                                // create the value nodes
                                if( allValues != null)
                                {
                                        while(allValues.hasMoreElements())
                                        {
                                                var valueElement = document.createElement("value");
                                                valueElement.appendChild(document.createTextNode(allValues.nextElement()));
                                                attrElement.appendChild(valueElement);
                                        }
                                        instanceElement.appendChild(attrElement);
                                }
                        }
                        outputElement.appendChild(instanceElement);
                        nodeSet.add(instanceElement);
                }
        }
        catch(e)
        {
                var statusElement = document.createElement("status");
                statusElement.setAttributeNS(null, "level", "error");
                statusElement.appendChild(document.createTextNode(e.toString()));
                outputElement.appendChild(statusElement);
                nodeSet.add(statusElement);
        }
        finally
        {
           // disconnect with the server
                lc.disconnect();
        }
        return nodeSet;
}
function serialize(nodeSet)
{
        var stringWriter = new java.io.StringWriter();
        for (var node = nodeSet.first(); node; node=nodeSet.next())
        {
                var domWriter = new Packages.com.novell.xml.dom.DOMWriter(node, stringWriter);
                domWriter.setIndent(true);
                domWriter.write();
                domWriter.flush();
                stringWriter.write('\\n');
        }
        return stringWriter.toString();
}

Next up, we have one I got from Father Ramon in the support forums, append to file, which is a great way to write out to a [log file](http://www.novell.com/communities/glossary/term/1663), in the drivers local [file system](http://www.novell.com/communities/glossary/term/1388), via ECMA Script.

While we have a couple of send email tokens in DirXML Script, there is no simple way to log stuff into a file. Well now there is, courtesy of ECMA Script!

function appendToFile(fileName, text)
{
    var fileWriter = new java.io.FileWriter(fileName, true);
    try
    {
        fileWriter.write(text);
        fileWriter.write("\\n");
    }
    finally
    {
        fileWriter.close();
    }
}

The next series turn out to be astonishingly fast and powerful implementations of a unique() function, a duplicate() function, and a blanks() function.

If you need to test if a value matches any single value in a node set, then DirXML Script is great for that. The equality test of a node set against a single value will test to see if that single value occurs anywhere in the values in the node set. The problem comes up when you have a node set with lots of values and you want to clean it up, so that any duplicates are removed, or else just want the duplicates, then these functions can really help.

Now you could loop through one of those node sets, and then test the current node value against the entire node set, but it turns out that when you have a couple of thousand of objects in the node set it can take a really long time to do this kind of a compare. Now there turn out to be a number of tricks to make this more efficient and I discuss a number of them in my series on toolkit rules:

* [Toolkit Rules in Identity Manager Part 1](http://www.novell.com/communities/node/6308/toolkit-rules-identity-manager-part-1)
* [Toolkit Rules in Identity Manager Part 2](http://www.novell.com/communities/node/6310/toolkit-rules-identity-manager-part-2)
* [Toolkit Rules in Identity Manager Part 3](http://www.novell.com/communities/node/6316/toolkit-rules-identity-manager-part-3)
* [Toolkit Rules in Identity Manager Part 4](http://www.novell.com/communities/node/6440/toolkit-rules-identity-manager-part-4)
* [Example of a Use for a Toolkit Rule in Identity Manager](http://www.novell.com/communities/node/6441/example-use-toolkit-rule-identity-manager)
* [Another Toolkit Rule Use Example, Bad Attribute Value Cleanup](http://www.novell.com/communities/node/6514/another-toolkit-rule-use-example-bad-attribute-value-cleanup)

Things like disabling trace is a big one, but there are all sorts of interesting other things that can be done, to specifically tone down trace when it is painful to performance.

My first iteration of a rule working with about 6000 nodes using a brute force approach ran for over 2 hours before I killed it and gave up. Using this set of functions, I got the run time down to under two minutes total (and it had to do a lot more than just this one function).

importPackage(Packages.com.novell.xml.xpath);
importPackage(Packages.com.novell.xsl.util);
importClass(java.util.HashSet);
/\*\* Create a NodeSet that eliminates nodes from the input nodeset with duplicate string values
 \* @param {String} input    the input NodeSet
 \* @type NodeSet
 \* @return a NodeSet that eliminates nodes from the input nodeset with duplicate string values
 \*/
function unique(input)
{
    // create the output node set
    var nodeSet = new InsertionOrderNodeSet();
    
    // create HashSet to keep track of duplicates
    var set = new HashSet();
    
    // loop through the Nodes in the NodeSet
    for (var node = input.first(); node != null; node = input.next())
    {
        var value = Util.getXSLStringValue(node).toUpperCase();
        if (!set.contains(value))
        {
           set.add(value);
           nodeSet.add(node);
        }
    }
    return nodeSet;
}

Next up is sort of the converse of unique() which is duplicates() which will return only the duplicate values in the nodeset it is passed. This is useful if you need to find out if any values in a node set are duplicates.

Note, you will need the import commands from the beginning of the unique() function if you want to use just this function.

/\*\* Create a NodeSet that contains nodes from the input nodeset with duplicate string values
 \* @param {String} input    the input NodeSet
 \* @type NodeSet
 \* @return a NodeSet that contains only nodes from the input nodeset with duplicate string values
 \*/
function duplicate(input)
{
    // create the output node set
    var nodeSet = new InsertionOrderNodeSet();
    
    // create HashSet to keep track of duplicates
    var set = new HashSet();
    
    // loop through the Nodes in the NodeSet
    for (var node = input.first(); node != null; node = input.next())
    {
        var value = Util.getXSLStringValue(node).toUpperCase();
        if (set.contains(value))
        {
           nodeSet.add(node);
        }
                else
                {
                        set.add(value);
                }
    }
    return nodeSet;
}

Next up is bittest() which is great for when you want to look at bit mask attributes. For example the [ACL](http://www.novell.com/communities/glossary/term/3314) attribute uses bit mask values to represent object rights as a decimal number. DirXML Script has no [binary](http://www.novell.com/communities/glossary/term/508) operators included, which normally is not an issue. However for times when you need it, here it is to use! You pass it a value, the bit in decimal that you want to test for, and it returns true or false.

/\*\* Perform a binary compare for a bitmask
 \* @param {int} value    binary value, as a decimal representation
 \* @param {int} bits     binary value, as a decimal representation
 \* @type int
 \* @return boolean true or false if the tested VALUE contains the BIT specified.
 \*/
function bittest(value, bits)
{
  return ((value & bits) == bits);
}

Well that is my collection so far, what can you contribute? Try and post it into the comments, and I can try and edit the article to add them. Or feel free to email me directly with your functions and I will add them to the article. My email is [geoffreycarman@gmail.com](mailto:geoffreycarman@gmail.com) so send away.

Update Jun 11, 2009: And the updates start coming in! Yay! Thanks to those who emailed me with samples.

Justin Birt referenced a bunch of other articles out there with nice ECMA examples in them:
[http://www.novell.com/communities/node/5883/using-...](http://www.novell.com/communities/node/5883/using-ecma-scripts-idm-policy-rules)
[http://www.novell.com/communities/node/6073/exchan...](http://www.novell.com/communities/node/6073/exchange-2007-management-shell-cmdlet-execution-within-idm-policy-rules)
[http://www.novell.com/communities/node/6256/load-b...](http://www.novell.com/communities/node/6256/load-balancing-mailboxes-across-exchange-2007-message-stores-using-idm-policy-rules)

Nathan Spears sent me this one, in the name of Father Ramon (The partonizing saint of DirXML as he used to say).

importClass(Packages.com.novell.xml.util.Base64Codec);
/\*\*
\* Convert a Base64 encoded GUID attribute value to an ASCII string
\* in the format the NDS2NDS driver uses as its association.
\*
\* @param {String} s Base64 encoded GUID attribute value
\*
\* @type String
\* @return ASCII string
\*
\* @throws IOException -
\*/
function base64conversion(s)
{
var bytes = Base64Codec.decode(s);
var s1 = encodeAsciiHex(bytes);
return s1;
}
var digits = \[
"0", "1", "2", "3", "4", "5", "6", "7", "8", "9",
"A", "B", "C", "D", "E", "F"
\];
function encodeAsciiHex(abyte0)
{
var buffer = "";
for(var i = 0; i < abyte0.length; i++)
{
var byte0 = abyte0\[i\];
buffer += digits\[byte0 >> 4 & 0xf\];
buffer += digits\[byte0 & 0xf\];
}
return buffer;
}

This is useful to convert GUID's which are Base64 encoded, back into strings.

Updated Oct 29, 2009

Michael Brian Hansen, from Denmark, from KMD A/S consulting, which you can find at their website [http://www.kmd.dk](http://www.kmd.dk/) sent me the following samples:

Read froma file:

function ReadFromFile(fileName)
{
           // Open an input stream
           var fileReader = new java.io.FileInputStream(fileName);
           try
           {
                          // Read a line of text
                          var Indhold = new DataInputStream(fileReader).readLine();
                          return Indhold;
           }
           finally
           {              // Close our input stream
                        fileReader.close();           
           }
}

He also sent: Decrypt [PGP](http://www.novell.com/communities/glossary/term/2677) password key:

function PGP(UserPasswordGPG)
{
var path = "/tmp/idmlog/";
var fileName = "log.txt";
var fileName\_err = "log\_err.txt";
var password\_enc = UserPasswordGPG;
var pgpcmd = "gpg --homedir /var/novell --decrypt --batch";
var pgpmsg = "-----BEGIN PGP MESSAGE-----\\n\\n" + password\_enc + "\\n-----END PGP MESSAGE-----";
var cmd = new Array();
cmd\[0\] = "/bin/sh";
cmd\[1\] = "-c";
cmd\[2\] = "echo \\"" + pgpmsg +"\\"" + " | " + pgpcmd;
var rt = java.lang.Runtime.getRuntime();
try {
           var pr = rt.exec(cmd);
}
           catch(err) {
           //print(err)
           appendToFile(fileName\_err,err);
           quit(1);
           }
var input = new java.io.BufferedReader(new java.io.InputStreamReader(pr.getInputStream()));
var input\_err = new java.io.BufferedReader(new java.io.InputStreamReader(pr.getErrorStream()));
var line = null;
var output\_txt = "";
while((line=input.readLine()) != null) {
           //output\_txt = output\_txt + "\\n" + line
           //print(line);
           return line;
}
var returnVal = pr.waitFor();
}

Note:
‘/var/novell’ path, is where you place the ‘pubring.gpg secring.gpg trustdb.gpg’ file.

Michael also included a library file, attached as libAJC.txt (since I cannot attach a .xml file) that has a whole stack of ECMA functions! (2000+ lines of ECMA!). Great stuff, so much I have not even had time to process and work through them all yet.

Keep them coming! What I think I will do is add all the examples I get into a Library file in my scratchbook Designer project and attach it as a file so you can download a single file with all the examples so far.

I attached it as ECMALibrary.txt, but rename it to XML (Since Cool Solutions does not want me to upload XML files to it) and import it into your Designer to see all the ECMA examples so far! Stick it in a Library in your project and you should be good to use any of them as needed! (Libraries are cool!)

|     |     |
| --- | --- |
| **Attachment** | **Size** |
| [ECMALibrary.txt](http://www.novell.com/communities/files/ECMALibrary.txt) | 8.91 KB |
| [lib-AJC.txt](http://www.novell.com/communities/files/lib-AJC.txt) | 68.34 KB |

### Author Info

9 June 2009 - 3:01pm
Submitted by: [geoffc](http://www.novell.com/communities/user/555)

[Author Blog](http://www.novell.com/communities/blog/555)
[Author Profile](http://www.novell.com/communities/user/555)

### Tags

[DirXML](http://www.novell.com/communities/taxonomy/term/6) [eDirectory](http://www.novell.com/communities/taxonomy/term/7) [Identity Manager](http://www.novell.com/communities/taxonomy/term/11) [Identity Manager 3.5](http://www.novell.com/communities/taxonomy/term/3422)
[Tags Map](http://www.novell.com/communities/site-tags)

## Related Articles

* [Synchronizing an eDirectory GUID to an Oracle Database](http://www.novell.com/communities/node/4095/synchronizing-edirectory-guid-oracle-database)
* [Adding Regular Expression Matching to XPath in Identity Manager](http://www.novell.com/communities/node/8434/adding-regular-expression-matching-xpath-identity-manager)
* [Another Node Set Size Discussion](http://www.novell.com/communities/node/6176/another-node-set-size-discussion)
* [Finding the Largest Nodeset with an IDM Rule](http://www.novell.com/communities/node/4374/finding-largest-nodeset-with-idm-rule)
* [Calling Stored Procedures with the IDM JDBC Driver](http://www.novell.com/communities/node/2786/calling-stored-procedures-idm-jdbc-driver)

## User Comments

[![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/picture-2810.jpg]]](http://www.novell.com/communities/user/2810)

## [Great stuff!](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#comment-6916)

Submitted by [preycor](http://www.novell.com/communities/user/2810) on 22 October 2009 - 1:55am.

Thanks for kicking this off and contributing so much! I've seen and used a lot of JavaScript that can be used in ECMAScript for IDM but there are situations where it just won't work. I think it may be useful at some point to have an article written with guidelines for exactly what can and can't be done within IDM's ECMAScript. I've been meaning to look into it but haven't had the chance yet - perhaps you will before me? ;)

* [Login](http://www.novell.com/communities/user/login?destination=node/8439%2523comment-form) to post comments

[![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/picture-555.jpg]]](http://www.novell.com/communities/user/555)

## [The more ECMA samples the better](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#comment-6919)

Submitted by [geoffc](http://www.novell.com/communities/user/555) on 22 October 2009 - 10:23am.

I agree fully. Lets keep updating both the Wiki and the article. The more copies of the data, the easier people will find it when they search.

You are welcome to copy all the examples here into the Wiki if you feel like it. I just don't like editing text in a format other than raw [this page](http://www.novell.com/communities/glossary/term/496) you can look up ASCII characters and descriptions.">ASCII and then using markup on it. (Though I suppose LROFF would be ok... Or maybe TeX. )

ASCII rules! EBCDIC sucks! (Oh no, IBM'ers with pitchforks at the door!)

As a funny aside, I was working on an AS400 driver, and the [log file](http://www.novell.com/communities/glossary/term/1663), is actually written in EBCDIC! And if you did not transfer it properly, it would look like gooble-de-gook.

Very funny! Otherwise I would have said I am young enough never to have needed to touch/see EBCDIC. But alas that is no longer true!

Darn you IBM! Darn you to sock heck! You have ruined my single basic encoding method streak! (Like my streak on going up the Empire State Building (86 stories, once), CN Tower (100+ stories, 5 times), and Rockfeller Center (66 stories, once)! Only ever taken elevators DOWN from them! Stairs up all the way so far! )

* [Login](http://www.novell.com/communities/user/login?destination=node/8439%2523comment-form) to post comments

![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/picture-2810.jpg]]

## [Some tools for you... :)](http://www.novell.com/communities/node/8439/open-call-useful-ecma-functions-use-identity-manager#comment-6921)

Submitted by [preycor](http://www.novell.com/communities/user/2810) on 23 October 2009 - 12:37am.

I think you might find this useful - it converts text to markup.
<http://www.textism.com/tools/textile/index.php>

The best I could find in terms of an EBCDIC to [this page](http://www.novell.com/communities/glossary/term/496) you can look up ASCII characters and descriptions.">ASCII converter was this one.
<http://www.pacsys.com/ebccnv.htm>

I'd love to see someone write a plugin to [Notepad++](http://notepad-plus.sourceforge.net/uk/site.htm) to do conversions like these. :)

* [Login](http://www.novell.com/communities/user/login?destination=node/8439%2523comment-form) to post comments

[Novell® Making IT Work As One™](http://www.novell.com/company/strategy.html)

* [Careers](http://www.novell.com/company/careers/index.html)
* [Contact Us](http://www.novell.com/company/contacts-offices)
* [Feedback](http://www.novell.com/inc/feedback/feedback.jsp)
* [Legal](http://www.novell.com/company/legal)
* 

© 2009 Novell, Inc. All Rights Reserved.

![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/0.gif]]
![[./_resources/Open_Call_for_useful_ECMA_functions_to_use_in_Identity_Manager__Novell_User_Communities.resources/search-q=com.nodeset+examples%26ie=utf-8%26oe=utf-8%26aq=t%26rlz=1R1GGGL_en___US345%26client=firefox-a&tzo=420&ms=93]]
