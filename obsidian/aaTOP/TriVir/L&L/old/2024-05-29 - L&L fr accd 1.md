5/29/2024 12:31:48 PM

My first L&L to catch up

Carl's notes:
https://docs.google.com/document/d/1Es_ka6ejKKmcXNGMIE__ArChQXEKkAvL_vh0lb5pjnQ/edit


 - Create user, and home dir:
	 - sudo useradd forgerock -m -d /home/forgerock
	 - passwd forgerock (trivir)
	 - sudo usermod -aG wheel forgerock

sidenote: Brian Alternate
https://brain-hol.github.io/notes/linux/service-accounts.html
su <service-account> -s /bin/bash

Getting java rpm . .

5/29/2024 12:55:14 PM
INstalled java

**[https://www.azul.com/core-post-download/?endpoint=zulu&uuid=d157c8eb-e24f-448b-acd3-deb15b06911b](https://www.azul.com/core-post-download/?endpoint=zulu&uuid=d157c8eb-e24f-448b-acd3-deb15b06911b)**

![[Pasted image 20240529125552.png]]


su forgerock (trivir)

add to /etc/hosts:

172.17.2.75 ds-config1.dev.trivir.com ds-userstore1.dev.trivir.com ds-cts1.dev.trivir.com
172.17.2.76 ds-config2.dev.trivir.com ds-userstore2.dev.trivir.com ds-cts2.dev.trivir.com

next:
down load zip
https://backstage.forgerock.com/downloads/browse/ds/featured

Create a deployment ID
- run install script





raw copy of deleteme:

**  

---

Random AM Training Notes

---

  

Installed 7.5.1

[https://kb.vmware.com/s/article/79832](https://kb.vmware.com/s/article/79832)

I don't know how to fix this problem.

  

[AM Accreditation 1 - Setting Up DS Config Store](https://docs.google.com/document/d/1Ge_ZlCLNjws44v6qFW3PvdwgwVghHMnreaHZba4ypYs/edit#heading=h.hdllicon76ug)

  

Create the user

sudo useradd {username} -m -d {path to home dir}

sudo useradd forgerock -m -d /home/forgerock

As root: passwd forgerock

cat /etc/passwd

sudo usermod -G wheel forgerock

sudo vigr shows he is in the wheel group as well.

  

Will did this: sudo usermod -aG wheel forgerock

  
  

[trivir@am1 ~]$ java -version

openjdk version "17.0.11" 2024-04-16 LTS

OpenJDK Runtime Environment Zulu17.50+19-CA (build 17.0.11+9-LTS)

OpenJDK 64-Bit Server VM Zulu17.50+19-CA (build 17.0.11+9-LTS, mixed mode, sharing)

  

[dev.trivir.com](http://dev.trivir.com) for hostnames.....

  

---

  

if tar verison of java (This is in the docs)

- Create a [java.properties](http://java.properties) in the DS install folder.
    
- Something likeDefaul.javaHome =  then your java ath
    
- Java in /opt/java17
    

  

- (Optional, but helpful) Setup hostnames in the /etc/hosts file for each server that we can use to reference the server for the config store DS instance.
    

[ds1.dev.trivir.com](http://ds1.dev.trivir.com)

  

[ds2.dev.trivir.com](http://ds2.dev.trivir.com)

  

- Download DS from Backstage. We want the latest version of 7.5.
    

- Download the ZIP version.
    
- First one points to itself and second points to the first one.
    
- Replicatoin are DS servers.
    

You can have DS severs to handle LDAP load

Then fewer servers specifically for the replication of those servers.

TriVir#1

With accreditation

5/8/2024

Shared over chat:

[https://backstage.forgerock.com/docs/am/7.5/install-guide/prerequisites-file-descriptors.html](https://backstage.forgerock.com/docs/am/7.5/install-guide/prerequisites-file-descriptors.html)

[trivir@am1 opt]$ sudo systemctl disable firewalld

Removed "/etc/systemd/system/multi-user.target.wants/firewalld.service".

Removed "/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service".

[trivir@am1 opt]$ sudo systemctl stop firewalld

---

  

# Install DS

  

Questions:

- We keep talking about the service account, but then we don't login as that person and we don' talk about running commands as that person.
    

Use my ForgeRock user to do the install.

- What is the correct way to permanently set the environment variable. I just set it, but I know that is temporary... (export DEPLOYMENT_ID)
    

AM account needs to have a home directory.

Java_Home variable set - If we were using same env could put on higher level.....

Use java that is controlled separately from the system level java.

We create an init script at the end. We could the environment variable there..... It is a systemd script.

Tomcat you can set it in the [setenv.sh](http://setenv.sh)

  

After install, there is aconfigstore directory.

You can create a [java.properties](http://java.properties) there...

[default.java-home=/opt/java17](about:blank)

  

3 sets of DS

Configstore for AM

Userstore

CTS (Core Token Services). oauth token for sessions etc get stored here.

  

---

Other Stuff

- We mentioned setting up /etc/hosts but not what we would setup there.
    

I would think I would setup [ds1.dev.trivir.com](http://ds1.dev.trivir.com) and point it to this IP address.

[ds-config1.dev.trivr](http://ds-config1.dev.trivr). pointed to my IP in the settings.....

ip then [configrestore1.dev.trivir.com](http://configrestore1.dev.trivir.com) then you can put alternate names separate by sape.

- my hostname should be this box... I was going to say [ds1.trivirdev.com](http://ds1.dev.com).
    
- But I was also going to put that for the replicatoin server too.
    

  

---

## ds-config vm1

- Disable the firewall
    

sudo systemctl stop firewalld

sudo systemctl disable firewalld

- Java download:
    

[https://www.azul.com/core-post-download/?endpoint=zulu&uuid=d157c8eb-e24f-448b-acd3-deb15b06911b](https://www.azul.com/core-post-download/?endpoint=zulu&uuid=d157c8eb-e24f-448b-acd3-deb15b06911b)

[ds-config1.dev.trivir.com](http://dsconfig1.dev.trivir.com)

  
  
  

/opt/ds-config

- First one point to itself... Put the hostname...
    
- Second one bootstrap points back to 1....
    
- You are telling your server to pull up the registraiotn from that other server. It would get all that server info by talking to the one server.
    
- If I run my second command, I would just change the hostname.....
    
- Before had to piont to all servers, now just point to one.
    

ds-[userstore1.dev.trivir.com](http://userstore1.dev.trivir.com)

/opt/ds-userstore

ds-[cts1.dev.trivir.com](http://cts1.dev.trivir.com)

/opt/ds-cts

  

etc hosts:

[172.17.2.75](http://172.17.2.75)    [ds-config1.dev.trivir.com](http://ds-config1.dev.trivir.com) [ds-userstore1.dev.trivir.com](http://ds-userstore1.dev.trivir.com) [ds-cts1.dev.trivir.com](http://ds-cts1.dev.trivir.com)

[172.17.2.76](http://172.17.2.76)  [ds-config2.dev.trivir.com](http://ds-config1.dev.trivir.com) [ds-userstore2.dev.trivir.com](http://ds-userstore1.dev.trivir.com) [ds-cts2.dev.trivir.com](http://ds-cts1.dev.trivir.com)

  

- Unzipped file and moved
    

sudo cp -r /home/trivir/Downloads/DS-7.5.0/opendj/ /opt/

sudo unzip /home/forgerock/DS-7.5.0.zip -d /opt/ds-config

  
  

- Create a deployment ID.
    

- [https://backstage.forgerock.com/docs/ds/7.5/security-guide/pki.html#about-deployment-ids](https://backstage.forgerock.com/docs/ds/7.5/security-guide/pki.html#about-deployment-ids)
    

sudo /opt/ds-config/opendj/bin/dskeymgr create-deployment-id

  

/opt/ds-config/opendj/setup \
--deploymentId ASmWGeBPYxr5_1cCKSREIauI1CazhEw5CBVN1bkVDdyPbiaTIS7qdng \
--deploymentIdPassword TriVir#1 \
--rootUserDN uid=admin \
--rootUserPassword TriVir#1 \
--monitorUserPassword TriVir#1\
--hostname [ds-config1.dev.trivir.com](http://ds-config1.dev.trivir.com) \
--adminConnectorPort 1444 \
--ldapPort 1389 \
--enableStartTls \
--ldapsPort 1636 \
--httpsPort 1443 \
--replicationPort 1989 \
--bootstrapReplicationServer [ds-config1.dev.trivir.com](http://ds-config1.dev.trivir.com):1989 \
--profile am-config \
--set am-config/amConfigAdminPassword:TriVir#1 \
--acceptLicense

  

Error if files owned by root

Setup profile 'am-config:7.5.0' cannot be found. There are no setup profiles

available for this OpenDJ version

  

Success

Validating parameters..... Done

Configuring certificates..... Done

Configuring server...... Done

Configuring profile AM configuration data store..................... Done

-

To see basic server status and configuration, you can launch

/opt/ds-config/opendj/bin/status

  
  
  

Systemd Script

sudo vi /etc/systemd/system/ds-config.services

[Unit]

Description=ForgeRock DS

After=network.target

  

[Service]

Type=forking

  

ExecStart=/opt/ds-config/opendj/bin/start-ds

ExecStop=/opt/ds-config/opendj/bin/stop-ds

  

User=forgerock

Group=forgerock

  

[Install]

WantedBy=[multi-user.target](http://multi-user.target)

  

sudo systemctl daemon-reload

sudo systemctl start ds-config

  
  
  

---

## ds-config vm2

- Java download:
    

[https://www.azul.com/core-post-download/?endpoint=zulu&uuid=d157c8eb-e24f-448b-acd3-deb15b06911b](https://www.azul.com/core-post-download/?endpoint=zulu&uuid=d157c8eb-e24f-448b-acd3-deb15b06911b)

[ds-config2.dev.trivir.com](http://dsconfig2.dev.trivir.com)

ds-[userstore2.dev.trivir.com](http://userstore2.dev.trivir.com)

ds-[cst2.dev.trivir.com](http://cst2.dev.trivir.com)

- etc hosts:
    

[172.17.2.76](http://172.17.2.76)  [ds-config2.dev.trivir.com](http://ds-config1.dev.trivir.com) [ds-userstore2.dev.trivir.com](http://ds-userstore1.dev.trivir.com) [ds-cts2.dev.trivir.com](http://ds-cts1.dev.trivir.com)

[172.17.2.75](http://172.17.2.75)    [ds-config1.dev.trivir.com](http://ds-config1.dev.trivir.com) [ds-userstore1.dev.trivir.com](http://ds-userstore1.dev.trivir.com) [ds-cts1.dev.trivir.com](http://ds-cts1.dev.trivir.com)

  

- From box 1 move over all the files.
    

scp -r /home/forgerock/DS-7.5.0.zip forgerock@ds-config2.dev.trivir.com:/home/forgerock

scp -r /home/forgerock/zulu17.50.19-ca-jdk17.0.11-linux.x86_64.rpm forgerock@ds-config2.dev.trivir.com:/home/forgerock

  

- Disable the firewall
    

sudo systemctl stop firewalld

sudo systemctl disable firewalld

  

- Copy over the files.
    

sudo cp -r /home/trivir/Downloads/DS-7.5.0/opendj/ /opt/

- Unzip
    

sudo unzip /home/forgerock/DS-7.5.0.zip -d /opt/ds-config

  

- Create a deployment ID. Not needed on second VM.
    

  

- Windows hosts file:
    

C:\Windows\System32\drivers\etc\hosts

cd

/opt/ds-config/opendj/setup \

--deploymentId ASmWGeBPYxr5_1cCKSREIauI1CazhEw5CBVN1bkVDdyPbiaTIS7qdng \

--deploymentIdPassword TriVir#1 \

--rootUserDN uid=admin \

--rootUserPassword TriVir#1 \

--monitorUserPassword TriVir#1\

--hostname [ds-config2.dev.trivir.com](http://ds-config1.dev.trivir.com) \

--adminConnectorPort 1444 \

--ldapPort 1389 \

--enableStartTls \

--ldapsPort 1636 \

--httpsPort 1443 \

--replicationPort 1989 \

--bootstrapReplicationServer [ds-config1.dev.trivir.com](http://ds-config1.dev.trivir.com):1989 \

--profile am-config \

--set am-config/amConfigAdminPassword:TriVir#1 \

--acceptLicense

  

- Systemd Script
    

  

Create this file:

sudo vi /etc/systemd/system/ds-config.service

  

Here are the contents of the file:

[Unit]

Description=ForgeRock DS

After=network.target

  

[Service]

Type=forking

  

ExecStart=/opt/ds-config/opendj/bin/start-ds

ExecStop=/opt/ds-config/opendj/bin/stop-ds

  

User=forgerock

Group=forgerock

  

[Install]

WantedBy=[multi-user.target](http://multi-user.target)

  

Run these commands to load in the file and then start DS:

sudo systemctl daemon-reload

sudo systemctl start ds-config

  
  
  
  

---

  
  

[dsauth1.dev.trivir.com](http://dsauth1.dev.trivir.com)

[dsauth2.dev.trivir.com](http://dsauth2.dev.trivir.com)

  
  
  

---

  
  

- Follow the installation instructions to install DS on the first server.
    

- [https://backstage.forgerock.com/docs/ds/7.5/install-guide/profile-am-config.html](https://backstage.forgerock.com/docs/ds/7.5/install-guide/profile-am-config.html)
    
- Note that we will eventually have 3 instances of DS on each server, so keep notes of the ports you selected.
    
- It is good to keep notes of the configuration parameters you used to configure DS. If you messed something up, you can delete the DS instance and start over.
    
- The replication bootstrap should point to itself.
    

- Follow the installation instructions to install DS on the second server.
    

- Use the same deployment ID and password as on the first server.
    
- The replication bootstrap should point to the first server.
    
- For simplicity, it is best to use the same ports for the second server that you used for the first server.
    

  

Setup the AutoStartup:

[https://git.trivir.com/projects/FR-ANSIBLE/repos/fr-roles/browse/trivir/forgerock_ds/install/templates/ds_service.j2](https://git.trivir.com/projects/FR-ANSIBLE/repos/fr-roles/browse/trivir/forgerock_ds/install/templates/ds_service.j2)

[Unit]

Description=ForgeRock DS

After=network.target

  

[Service]

Type=forking

  

ExecStart={{ ds_install_dir }}/{{ ds_instance_dir }}/bin/start-ds

ExecStop={{ ds_install_dir }}/{{ ds_instance_dir }}/bin/stop-ds

  

User={{ service_account }}

Group={{ service_group }}

  

[Install]

WantedBy=multi-user.target

---

  
  
  

5/22/2024

  
  
**




7/31/2024 12:03:00 PM
L&L
 - Trivir#1

 - finsihing from am accreditation 3 - instal am on server 1
config host store: use the same name as the cert . .

Created AM dir for home directory
/home/forgerock/am

JAVA_HOME=/opt/java17


install-openam --serverUrl http://am1.dev.trivir.com:8080/am \
 --adminPwd TriVir#1 \
 --acceptLicense \
 --cookieDomain trivir.com \
 --cfgDir /home/forgerock/am \
 --cfgStore dirServer \
 --cfgStoreHost ds-config1.dev.trivir.com \
 --cfgStoreAdminPort 1444 \
 --cfgStorePort 1636 \
 --cfgStoreRootSuffix ou=am-config \
 --cfgStoreDirMgr uid=am-config,ou=admins,ou=am-config \
 --cfgStoreDirMgrPwd TriVir#1 \
 --cfgStoreSsl SSL


 ldap://ds-config1.dev.trivir.com:1636/????X-CONNECTION-NAME=ds-config1.dev.trivir.com,X-ENCRYPTION=ldaps,X-BIND-USER=uid=am-config%2cou=admins%2cou=am-config,X-BIND-PASSWORD=TriVir#1,X-COUNT-LIMIT=1000


ldap://ds-config1.dev.trivir.com:1636/????X-CONNECTION-NAME=ds-config1.dev.trivir.com,X-ENCRYPTION=ldaps,X-BIND-USER=uid=am-config%2cou=admins%2cou=am-config,X-BIND-PASSWORD=TriVir#1,X-COUNT-LIMIT=1000


finding cfgstore name
configstore/bin/dsconfig
am1
1444
uid=am-config,ou=admins,ou=am-config
TriVir#1

no luck; pretty sure cer tis bad . .
/bin/keytool -import -file AM.der -keystore cacerts -alias dsconfig1-trivir

7/31/2024 1:19:53 PM - that was it! after putting in the cert, it woked successfully.

8/14/2024 12:41:41 PM
L&L next - installing am on second serer


8/14/2024 12:43:51 PM- working on this:
./dsrepl \
 initialize \
 --baseDN ou=am-config \
 --toAllServers \
 --hostname ds-config2.dev.trivir.com \
 --port 1444 \
 --bindDN uid=admin \
 --bindPassword TriVir#1 \
 --trustStorePath /opt/configstore/config/keystore \
 --trustStorePassword:file /opt/configstore/config/keystore.pin \
 --no-prompt



9/4/2024 12:26:46 PM
l&l sESSION
deployment password: TriVir#1
deployment key: AVcKO2dZHez5FwrPnDVzm_1uVCjdVuw5CBVN1bkVDA_1FmJmyLVWPZeg
am1
	ds1 -
	TriVir#1
export OPENDJ_JAVA_HOME=/opt/java17/

/home/forgerock/opendj/setup \
 --deploymentId AVcKO2dZHez5FwrPnDVzm_1uVCjdVuw5CBVN1bkVDA_1FmJmyLVWPZeg \
 --deploymentIdPassword TriVir#1 \
 --rootUserDN uid=admin \
 --rootUserPassword str0ngAdm1nPa55word \
 --monitorUserPassword str0ngMon1torPa55word \
 --hostname dsuserstore1.dev.trivir.com \
 --adminConnectorPort 4444 \
 --ldapPort 1390 \
 --enableStartTls \
 --ldapsPort 1637 \
 --httpsPort 8444 \
 --replicationPort 8989 \
 --bootstrapReplicationServer am1.dev.trivir.com:8989 \
 --profile am-identity-store \
 --set am-identity-store/amIdentityStoreAdminPassword:5up35tr0ng \
 --acceptLicense

use this for status:
/home/forgerock/opendj/bin/status

Second server on am - trying again, /opt/US2
/opt/US2/setup \
 --deploymentId AVcKO2dZHez5FwrPnDVzm_1uVCjdVuw5CBVN1bkVDA_1FmJmyLVWPZeg \
 --deploymentIdPassword TriVir#1 \
 --rootUserDN uid=admin \
 --rootUserPassword str0ngAdm1nPa55word \
 --monitorUserPassword str0ngMon1torPa55word \
 --hostname dsuserstore2.dev.trivir.com \
 --adminConnectorPort 4444 \
 --ldapPort 1390 \
 --enableStartTls \
 --ldapsPort 1637 \
 --httpsPort 8444 \
 --replicationPort 8989 \
 --bootstrapReplicationServer am1.dev.trivir.com:8989 \
 --profile am-identity-store \
 --set am-identity-store/amIdentityStoreAdminPassword:5up35tr0ng \
 --acceptLicense


Starting 9/11/2024 12:11:03 PM, doing second server above.
above was already ran; now running dsrepl 
t check
https://backstage.forgerock.com/docs/ds/7.5/config-guide/repl-status.html

/opt/US2/bin/dsrepl \
status \
--hostname dsuserstore1.dev.trivir.com \
--port 4444 \
--bindDN uid=admin \
--bindPassword str0ngAdm1nPa55word \
--trustStorePath /opt/US2/config/keystore \
--trustStorePassword:file /opt/US2/config/keystore.pin \
--no-prompt


status was healthy - listed GOOD three times.

